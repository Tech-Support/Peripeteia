#!/usr/bin/env ruby

require "readline"

def prompt(_prompt = "> ")
	Readline.readline(_prompt, true).squeeze(" ").strip.downcase
end

def symbol_for_direction(input)
	text = case input.downcase
	when "north", "east", "south", "west", "up", "down"
		input[0]
	when /^north ?east$/
		"ne"
	when /^north ?west$/
		"nw"
	when /^south ?east$/
		"se"
	when /^south ?west$/
		"sw"
	else
		input
	end
	text.to_sym
end

require_relative "lib/game_entity"
require_relative "lib/object_manager"
require_relative "lib/item"
require_relative "lib/scene"
require_relative "lib/scene_manager"
require_relative "lib/player"
require_relative "lib/controller"

SAVE_FILE = File.expand_path("~/.peripeteia_save")
$developer_mode = false

until ARGV.empty?
	case o = ARGV.shift
	when "-d", "--dev-mode"
		$developer_mode = true
	else
		puts "unrecognized option: #{o}"
		exit
	end
end

if File.file?(SAVE_FILE)
	f = File.open(SAVE_FILE, "r")
	controller = Marshal.load(f.read)
else
	controller = Controller.new
end

loop do
	ðŸ’¬ = prompt
	controller.handle_input(ðŸ’¬)
end
